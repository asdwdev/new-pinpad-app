<form id="createForm" class="max-w-2xl mx-auto bg-white rounded-xl border border-gray-200 shadow-sm">
  <!-- Card header -->
  <div class="px-6 py-4 border-b border-gray-100">
    <h2 class="text-base font-semibold text-gray-800">Create Pinpad</h2>
  </div>

  <!-- Card body -->
  <div class="px-6 py-6">
    <div class="hidden text-red-600 mb-4" id="formErrors"></div>

    <div class="grid grid-cols-1 gap-6">
      <!-- Serial Number -->
      <div>
        <label for="serialNumber" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          SERIAL NUMBER <span class="text-red-500">*</span>
        </label>
        <input id="serialNumber" name="serialNumber" maxlength="20" required autocomplete="off"
          placeholder="e.g. 0200640050298720" class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800 placeholder-gray-400
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" />
      </div>

      <!-- Branch Code -->
      <div>
        <label for="branchCode" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          BRANCH CODE <span class="text-red-500">*</span>
        </label>
        <select id="branchCode" name="branchCode" required class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
          <option value="">Select Branch</option>
        </select>
      </div>

      <!-- Status -->
      <div>
        <label for="status" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          STATUS <span class="text-red-500">*</span>
        </label>
        <select id="status" name="status" required class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
          <option value="">Select Status</option>
          <option value="Main">Main</option>
          <option value="Active">Active</option>
          <option value="InActive">InActive</option>
          <option value="Ready">Ready</option>
          <option value="NotReady">NotReady</option>
        </select>
      </div>

      <!-- Repair Status -->
      <div>
        <label for="repairStatus" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          REPAIR STATUS
        </label>
        <select id="repairStatus" name="repairStatus" class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
          <option value="">Select Repair Status</option>
        </select>
      </div>

      <!-- Terminal ID -->
      <div>
        <label for="terminalId" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          TERMINAL ID <span class="text-red-500">*</span>
        </label>
        <input id="terminalId" name="terminalId" maxlength="20" required autocomplete="off" placeholder="e.g. TID12345"
          class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800 placeholder-gray-400
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" />
      </div>

      <!-- Flag -->
      <div>
        <label for="flag" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          FLAG <span class="text-red-500">*</span>
        </label>
        <select id="flag" name="flag" required class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
          <option value="">Select Flag</option>
          <option value="0">0</option>
          <option value="1">1</option>
        </select>
      </div>

      <!-- Created Date -->
      <div>
        <label for="createdDate" class="block text-[11px] font-semibold tracking-wider text-gray-600 mb-1">
          CREATED DATE <span class="text-red-500">*</span>
        </label>
        <input type="date" id="createdDate" name="createdDate" required class="block w-full rounded-lg border border-gray-300 px-3 py-2.5 text-gray-800
                 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" />
      </div>
    </div>
  </div>

  <!-- Card footer (actions) -->
  <div class="px-6 py-4 border-t border-gray-100 flex items-center justify-end gap-3">
    <a asp-controller="Pinpad" asp-action="Index"
      class="px-5 py-2.5 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200">Cancel</a>
    <button type="submit" class="px-5 py-2.5 rounded-md bg-teal-600 hover:bg-teal-700 text-white">Create</button>
  </div>
</form>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const branchSelect = document.getElementById("branchCode");
    const repairSelect = document.getElementById("repairStatus");
    const form = document.getElementById("createForm");
    const formErrors = document.getElementById("formErrors");

    // === Load Branch Codes ===
    const branchRes = await fetch("http://localhost:5125/api/pinpads/branches");
    const branches = await branchRes.json();
    branches.forEach(b => {
      const opt = document.createElement("option");
      opt.value = b.code;
      opt.textContent = `${b.code} - ${b.name}`;
      branchSelect.appendChild(opt);
    });

    // === Load Repair Status ===
    const repairRes = await fetch("http://localhost:5125/api/pinpads/status-repairs");
    const repairs = await repairRes.json();
    repairs.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r.code;
      opt.textContent = `${r.code} - ${r.description}`;
      repairSelect.appendChild(opt);
    });

    // === Handle Form Submit ===
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      formErrors.classList.add("hidden");
      formErrors.textContent = "";

      const data = {
        serialNumber: document.getElementById("serialNumber").value,
        branchCode: document.getElementById("branchCode").value,
        status: document.getElementById("status").value,
        repairStatus: document.getElementById("repairStatus").value || null,
        terminalId: document.getElementById("terminalId").value,
        flag: document.getElementById("flag").value,
        createdDate: document.getElementById("createdDate").value
      };

      try {
        const res = await fetch("http://localhost:5125/api/pinpads", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (!res.ok) {
          const err = await res.json();
          formErrors.textContent = err.message || "Gagal menyimpan data.";
          formErrors.classList.remove("hidden");
        } else {
          // redirect ke index page setelah sukses
          window.location.href = "/Pinpad/Index";
        }
      } catch (error) {
        formErrors.textContent = "Terjadi kesalahan koneksi ke server.";
        formErrors.classList.remove("hidden");
      }
    });
  });
</script>
