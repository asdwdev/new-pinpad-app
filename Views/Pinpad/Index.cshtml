@* @{
    ViewData["Title"] = "Pinpad List";
}
<h1>Daftar Pinpad</h1>

<table id="pinpadTable" border="1">
    <thead>
        <tr>
            <th>ID</th>
            <th>Serial Number</th>
            <th>Status</th>
            <th>Branch</th>
            <th>Update Date</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function () {
            $.ajax({
                url: "http://localhost:5125/api/pinpads",
                method: "GET",
                success: function (res) {
                    if (res.success) {
                        let rows = "";
                        res.data.forEach(function (item) {
                            rows += `<tr>
                                                <td>${item.ppadId}</td>
                                                <td>${item.ppadSn}</td>
                                                <td>${item.ppadStatus}</td>
                                                <td>${item.ppadBranch}</td>
                                                <td>${item.ppadUpdateDate}</td>
                                            </tr>`;
                        });
                        $("#pinpadTable tbody").html(rows);
                    }
                },
                error: function (err) {
                    console.error(err);
                }
            });
        });
    </script>
} *@
<div class="p-4 md:p-6">
  <div class="mb-4 text-sm px-4 sm:px-0">
    <a href="#" class="text-teal-500 font-semibold hover:text-teal-600 transition-colors">Pinpad List</a> /
    <span class="text-gray-500">Inquiry</span>
  </div>

  <!-- Table Controls -->
  <div class="flex flex-col md:flex-row justify-between items-center mb-6">
    <!-- Search field -->
    <div class="flex items-center">
      <label class="text-sm text-gray-700 mr-3">Search:</label>
      <input type="text" placeholder="Search in all columns..."
        class="border border-gray-300 px-4 py-2 rounded focus:ring-2 focus:ring-blue-400 text-sm min-w-[250px]">
    </div>
  </div>

  <!-- Table Container -->
  <div class="bg-white shadow rounded-lg border border-gray-200 overflow-hidden ">
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="bg-gray-100 text-gray-700 text-sm">
          <th class="px-4 py-3 font-semibold">Branch</th>
          <th class="px-4 py-3 font-semibold">Serial Number</th>
          <th class="px-4 py-3 font-semibold">Register Date</th>
          <th class="px-4 py-3 font-semibold">Status</th>
          <th class="px-4 py-3 font-semibold">Action</th>
        </tr>
      </thead>
      <tbody id="tableBody" class="text-sm">

      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div class="flex flex-col md:flex-row justify-between items-center mt-4">
    <div class="text-sm text-gray-600 mb-2 md:mb-0" id="tableInfo">
      Showing 0 to 0 of 0 entries
    </div>
    <div class="flex space-x-1" id="paginationButtons">
      <button id="prevBtn"
        class="px-3 py-1 border rounded hover:bg-gray-100 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        disabled>
        Previous
      </button>
      <span id="pageNumbers" class="flex space-x-1"></span>
      <button id="nextBtn"
        class="px-3 py-1 border rounded hover:bg-gray-100 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        disabled>
        Next
      </button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      let currentPage = 1;
      const pageSize = 10;

      loadPinpads(currentPage);

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        return `${day}-${month}-${year} ${hours}:${minutes}:${seconds}`;
      }

      function loadPinpads(page) {
        $.ajax({
          url: 'http://localhost:5125/api/pinpads/inquiry',
          type: 'GET',
          dataType: 'json',
          data: { page: page, size: pageSize },
          success: function (response) {
            $('#tableBody').empty();
            const pinpads = response.data || [];

            if (pinpads.length === 0) {
              $('#tableBody').append('<tr><td colspan="15" class="text-center py-4">No data available</td></tr>');
            } else {
              $.each(pinpads, function (index, item) {
                const statusClass = getStatusClass(item.status);
                let row = `
                            <tr class="border-b hover:bg-gray-50">
                                <td class="px-4 py-3">${item.branch ?? ''}</td>
                                <td class="px-4 py-3 font-mono">${item.serialNumber ?? ''}</td>
                                <td class="px-4 py-3">${item.registerDate ? formatDate(item.registerDate) : ''}</td>
                                <td class="px-4 py-3">
                                    <span class="inline-block ${statusClass} px-3 py-1 rounded-full text-xs font-medium">
                                        ${item.status ?? ''}
                                    </span>
                                </td>
                                <td class="px-4 py-3">
                                    <button class="bg-blue-500 text-white w-8 h-8 rounded hover:bg-blue-600 transition-colors flex items-center justify-center">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                $('#tableBody').append(row);
              });
            }

            // Update info table
            const start = response.totalData === 0 ? 0 : (response.page - 1) * response.size + 1;
            const end = Math.min(start + pinpads.length - 1, response.totalData);
            $('#tableInfo').text(`Showing ${start} to ${end} of ${response.totalData} entries`);

            // Update tombol prev/next
            $('#prevBtn').prop('disabled', response.page <= 1);
            $('#nextBtn').prop('disabled', response.page >= response.totalPages);

            // Update nomor halaman dinamis
            updatePageNumbers(response.page, response.totalPages);

            currentPage = response.page;
          }
        });
      }

      function updatePageNumbers(current, totalPages) {
        const container = $('#pageNumbers');
        container.empty();

        const maxButtons = 5; // maksimal tombol halaman terlihat
        let startPage = Math.max(1, current - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);
        startPage = Math.max(1, endPage - maxButtons + 1);

        for (let i = startPage; i <= endPage; i++) {
          const btn = $('<button>')
            .addClass('px-3 py-1 border rounded text-sm transition-colors')
            .text(i)
            .toggleClass('bg-blue-500 text-white border-blue-500', i === current)
            .toggleClass('hover:bg-gray-100', i !== current)
            .on('click', function () {
              if (i !== currentPage) loadPinpads(i);
            });
          container.append(btn);
        }
      }

      $('#prevBtn').on('click', function () {
        if (currentPage > 1) loadPinpads(currentPage - 1);
      });

      $('#nextBtn').on('click', function () {
        loadPinpads(currentPage + 1);
      });

      function getStatusClass(status) {
        switch ((status || '').toLowerCase()) {
          case 'active': return 'bg-green-100 text-green-800';
          case 'inactive': return 'bg-gray-100 text-gray-800';
          case 'repair': return 'bg-yellow-100 text-yellow-800';
          default: return 'bg-gray-100 text-gray-800';
        }
      }
    });
  </script>
