@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Edit System Level";
    var sysLevelId = ViewBag.Id; // Id dikirim dari controller
}

<div class="max-w-2xl mx-auto bg-white shadow-md rounded-xl p-6">
    <h2 class="text-xl font-semibold mb-6">Edit System Level</h2>

    <form id="editSysLevelForm" class="space-y-4">
        <!-- Hidden ID -->
        <input type="hidden" id="sysLevelId" value="@sysLevelId" />

        <!-- Name -->
        <div>
            <label class="block text-sm font-medium text-gray-700">Name</label>
            <input type="text" name="name" id="name" required
                class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none">
        </div>

        <!-- Description -->
        <div>
            <label class="block text-sm font-medium text-gray-700">Description</label>
            <textarea name="description" id="description" rows="3"
                class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:outline-none"></textarea>
        </div>

        <!-- Save & Cancel -->
        <div class="flex justify-end space-x-3 pt-4">
            <a href="/SysLevel/Index"
                class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100">
                Cancel
            </a>
            <button type="submit" class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700">
                Update
            </button>
        </div>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(document).ready(function () {
        const sysLevelId = $("#sysLevelId").val();

        // Load existing data
        $.ajax({
            url: `http://localhost:5125/api/syslevels/${sysLevelId}`,
            method: "GET",
            success: function (res) {
                $("#name").val(res.name);
                $("#description").val(res.description);
            },
            error: function () {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load system level data'
                });
            }
        });

        // Handle update
        $("#editSysLevelForm").on("submit", function (e) {
            e.preventDefault();

            const formData = {
                name: $("#name").val(),
                description: $("#description").val()
            };

            $.ajax({
                url: `http://localhost:5125/api/syslevels/${sysLevelId}`,
                method: "PUT",
                contentType: "application/json",
                data: JSON.stringify(formData),
                success: function (res) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Updated',
                        text: res.message || 'System Level has been updated successfully!',
                        timer: 2000,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = "/RoleAkses/Index"; // redirect to list
                    });
                },
                error: function (xhr) {
                    const res = xhr.responseJSON;
                    Swal.fire({
                        icon: 'error',
                        title: 'Failed',
                        text: res?.message || 'Failed to update system level'
                    });
                }
            });
        });
    });
</script>
