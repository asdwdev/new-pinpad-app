@{
    ViewData["Title"] = "Edit Master Key";
}
<div class="max-w-3xl mx-auto p-6">
    <h1 class="text-lg text-gray-600 mb-6">Master Key / Edit</h1>

    <div class="bg-white rounded-lg shadow-sm p-6">
        <form id="editMasterKeyForm" class="space-y-6">
            <input type="hidden" id="mkeyId" />

            <div class="flex items-center">
                <label for="mkeyCode" class="w-32 text-right pr-4 text-sm text-gray-700">CODE:</label>
                <input type="text" id="mkeyCode" class="flex-1 px-3 py-2 border rounded text-sm" required />
            </div>

            <div class="flex items-center">
                <label for="mkeyNumber" class="w-32 text-right pr-4 text-sm text-gray-700">KEY NUMBER:</label>
                <input type="text" id="mkeyNumber" class="flex-1 px-3 py-2 border rounded text-sm" />
            </div>

            <div class="flex items-center">
                <label for="mkeyDesc" class="w-32 text-right pr-4 text-sm text-gray-700">KETERANGAN:</label>
                <input type="text" id="mkeyDesc" class="flex-1 px-3 py-2 border rounded text-sm" />
            </div>

            <div class="flex justify-end gap-3 mt-6">
                <a asp-action="Index" class="px-5 py-2 bg-orange-500 text-white rounded">Cancel</a>
                <button type="submit" class="px-5 py-2 bg-teal-600 text-white rounded">Update</button>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
const API_BASE = "http://localhost:5125";

// Ambil ID dari URL (misal /MasterKey/Edit/3)
const id = window.location.pathname.split("/").pop();

// Load detail
$.get(`${API_BASE}/api/sysmkeys/${id}`, function(res) {
    $("#mkeyId").val(res.mkeyId);
    $("#mkeyCode").val(res.mkeyCode);
    $("#mkeyNumber").val(res.mkeyNumber);
    $("#mkeyDesc").val(res.mkeyDesc);
});

// Submit update
$("#editMasterKeyForm").on("submit", function(e) {
    e.preventDefault();
    const data = {
        mkeyId: $("#mkeyId").val(),
        mkeyCode: $("#mkeyCode").val(),
        mkeyNumber: $("#mkeyNumber").val(),
        mkeyDesc: $("#mkeyDesc").val()
    };

    $.ajax({
        url: `${API_BASE}/api/sysmkeys/${id}`,
        method: "PUT",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: function() {
            Swal.fire('Berhasil!', 'Data berhasil diupdate.', 'success')
                .then(() => window.location.href = "/MasterKey/Index");
        },
        error: function(xhr) {
            Swal.fire('Gagal!', xhr.responseJSON?.message || "Update gagal.", 'error');
        }
    });
});
</script>
